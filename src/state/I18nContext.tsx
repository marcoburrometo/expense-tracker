"use client";
import React, { createContext, useContext, useCallback, useMemo } from 'react';

type Locale = 'it' | 'en';

// Flat key namespace: section.label
// Keep values minimal; punctuation stays in component if dynamic.
const translations: Record<Locale, Record<string, string>> = {
    it: {
        'nav.movements': 'Movimenti',
        'nav.config': 'Config',
        'nav.calendar': 'Calendario',
        'nav.menu': 'Menu',
        'nav.closeMenu': 'Chiudi',
        'nav.logout': 'Logout',
        'nav.login': 'Login',
        'nav.newWorkspace': 'Nuovo workspace',
        'nav.theme.toggle': 'Toggle tema',
        'nav.theme.mode': 'Modalità tema',
        'nav.theme.system': 'Sistema',
        'nav.theme.light': 'Chiaro',
        'nav.theme.dark': 'Scuro',
        'nav.language': 'Lingua',
        'lang.it': 'Italiano',
        'lang.en': 'Inglese',
        'workspace.externalSuffix': '(esterno)',
        'workspace.newPrompt': 'Nome nuovo workspace',
        'sync.local': 'Locale',
        'sync.saving': 'Salvataggio…',
        'sync.synced': 'Sincronizzato',

        // Alerts (dashboard / budgets)
        'alert.budget.nearLimit': 'Budget quasi al limite',
        'alert.budget.over': 'Budget superato',
        'alert.budget.fastPace': 'Budget in consumo veloce',
        'alert.noBudgets': 'Nessun budget definito',
        'alert.uncategorized': 'Movimenti senza categoria',

        'form.expense.new': 'Nuova Spesa',
        'form.expense.oneoff': 'Una Tantum',
        'form.expense.recurring': 'Ricorrente',
        'form.description': 'Descrizione',
        'form.amount': 'Importo',
        'form.date': 'Data',
        'form.category': 'Categoria',
        'form.direction.out': 'Uscita',
        'form.direction.in': 'Entrata',
        'form.frequency.weekly': 'Settimanale',
        'form.frequency.monthly': 'Mensile',
        'form.frequency.yearly': 'Annuale',
        'form.add': 'Aggiungi',
        'form.required': 'Richiesto',
        'form.invalidNumber': 'Numero non valido',
        'form.mustBeGtZero': 'Deve essere > 0',
        'form.dateRequired': 'Data richiesta',

        'calendar.prevMonth': 'Mese precedente',
        'calendar.nextMonth': 'Mese successivo',
        'calendar.today': 'Oggi',
        'calendar.month': 'Mese',
        'calendar.year': 'Anno',
        'calendar.incomeTotal': 'Entrate',
        'calendar.expenseTotal': 'Uscite',
        'calendar.density': 'Densità',
        'calendar.density.normal': 'Normale',
        'calendar.density.compact': 'Compatta',
        'calendar.showRecurring': 'Mostra ricorrenze',
        'calendar.heatmap': 'Heatmap',
        'calendar.heatmap.enable': 'Abilita heatmap',
        'calendar.heatmap.disable': 'Disabilita heatmap',
        'calendar.viewMode': 'Vista',
        'calendar.view.list': 'Lista',
        'calendar.view.category': 'Categorie',
        'calendar.incomes': 'Entrate',
        'calendar.expenses': 'Uscite',
        'calendar.weekdays.mon': 'Lun',
        'calendar.weekdays.tue': 'Mar',
        'calendar.weekdays.wed': 'Mer',
        'calendar.weekdays.thu': 'Gio',
        'calendar.weekdays.fri': 'Ven',
        'calendar.weekdays.sat': 'Sab',
        'calendar.weekdays.sun': 'Dom',
        'calendar.close': 'Chiudi',
        'calendar.backToToday': 'Torna ad Oggi',
        'calendar.dailySummary': 'Riepilogo giornaliero e movimenti.',
        'calendar.add.hint': 'Suggerimento: usa virgola o punto per i decimali.',

        'generic.close': 'Chiudi',
        'generic.on': 'On',
        'generic.off': 'Off',
        'quick.addOpen': 'Aggiungi veloce',
        'quick.addTitle': 'Aggiungi Rapido',
        'quick.cancel': 'Annulla',
        'quick.save': 'Salva',
        'quick.saving': '...',
        'quick.fastAdd': 'Aggiungi Rapido',
        'confirm.close': 'Chiudi',
        'table.empty': 'Nessun elemento',
        'budget.monthly': 'Mensile',
        'stats.income': 'Entrate',
        'stats.expenses': 'Uscite',
        'chart.ledger': 'Andamento',
        'mov.from': 'Da',
        'mov.to': 'A',
        'mov.direction': 'Direzione',
        'mov.direction.all': 'Entrate + Uscite',
        'mov.direction.in': 'Solo Entrate',
        'mov.direction.out': 'Solo Uscite',
        'mov.category': 'Categoria',
        'mov.category.all': 'Tutte',
        'mov.search': 'Cerca',
        'mov.search.placeholder': 'testo o categoria',
        'mov.density': 'Densità',
        'mov.density.normal': 'Normale',
        'mov.density.compact': 'Compatta',
        'mov.export': 'Export',
        'mov.income': 'Entrate',
        'mov.expenses': 'Uscite',
        'mov.net': 'Saldo Netto',
        'mov.finalBalance': 'Saldo Finale',
        'mov.sort': 'Ordinamento',
        'mov.col.date': 'Data',
        'mov.col.description': 'Descrizione',
        'mov.col.category': 'Categoria',
        'mov.col.amount': 'Importo',
        'mov.col.balance': 'Saldo',
        'mov.col.actions': 'Azioni',
        'mov.actions.save': 'Salva modifiche',
        'mov.actions.cancel': 'Annulla modifica',
        'mov.actions.edit': 'Modifica movimento',
        'mov.actions.delete': 'Elimina movimento',
        'mov.none': 'Nessun movimento',
        'mov.future': 'FUTURO',
        'mov.delete.title': 'Elimina movimento',
        'mov.delete.confirm': "Confermi l'eliminazione di",
        'mov.delete.irreversible': 'Questa azione è irreversibile.',
        'mov.delete.confirmLabel': 'Elimina',
        'mov.field.date': 'Data',
        'mov.field.category': 'Categoria',
        'mov.field.amount': 'Importo',
        'mov.field.balanceAfter': 'Saldo dopo',
        'expenses.title': 'Spese',
        'expenses.filter.all': 'Tutte',
        'expenses.filter.oneoff': 'Una Tantum',
        'expenses.filter.recurring': 'Ricorrenti',
        'expenses.badge.template': 'TEMPLATE',
        'expenses.badge.instance': 'RICORRENZA',
        'expenses.edit': 'Modifica',
        'expenses.delete': 'Elimina',
        'expenses.none': 'Nessuna spesa',
        'expenses.delete.title': 'Elimina spesa',
        'expenses.delete.confirm': 'Confermi l\'eliminazione della spesa selezionata?',
        'generic.cancel': 'Annulla',
        'generic.save': 'Salva',
        'budget.new': 'Nuovo Budget',
        'budget.limitMonthly': 'Limite Mensile',
        'budget.add': 'Aggiungi Budget',
        'budget.none': 'Nessun budget definito.',
        'budget.titleCurrentMonth': 'Budgets (Mese Corrente)',
        'budget.edit': 'Modifica',
        'budget.delete': 'Elimina',
        'budget.remaining': 'restano',
        'budget.over': 'superato di',
        'budget.limit': 'Limite',
        'budget.spentMonth': 'Speso mese',
        'budget.delete.title': 'Elimina budget',
        'budget.delete.confirm': 'Confermi l\'eliminazione del budget selezionato? I progressi del mese andranno persi.',
        'stats.incomeTotal': 'Entrate',
        'stats.expenseTotal': 'Uscite',
        'stats.balance': 'Saldo',
        'stats.balance.hint': 'Entrate - Uscite',
        'stats.categories': 'Categorie',
        'stats.categories.hint': 'Totali Distinti',
        'stats.recurring': 'Ricorrenti',
        'stats.recurring.hint': 'Template attivi',
        'stats.monthSpend': 'Spesa Mese',
        'stats.monthSpend.hint': 'Somma categorie',
        'chart.projections': 'Proiezioni',
        'chart.smooth': 'Smooth',
        'chart.points': 'Punti',
        'chart.last': 'Ultimo',
        'chart.lastReal': 'Ultimo reale',
        'chart.lastProjected': 'Ultimo proiettato',
        'chart.projectionBadge': 'proiezione',
        'chart.min': 'Min',
        'chart.max': 'Max',
        // Dashboard new components
        'dashboard.budget.title': 'Utilizzo Budget',
        'dashboard.budget.fastPace': 'Ritmo veloce',
        'dashboard.budget.near': 'Quasi limite',
        'dashboard.budget.over': 'Superato',
        'dashboard.category.uncategorized': 'Senza categoria',
        'dashboard.topCategories.title': 'Top Categorie',
        'dashboard.maxExpense': 'Spesa Maggiore',
        'dashboard.maxIncome': 'Entrata Maggiore',
        // Dashboard hint tooltips
        'dashboard.hint.budgetUsage': 'Avanzamento dei budget rispetto al limite mensile e velocità di consumo.',
        'dashboard.hint.topCategories': 'Categorie con maggiore spesa nel mese corrente (prime 5).',
        'dashboard.hint.extremes': 'Entrata e spesa singola più grandi registrate nel mese.',
        'dashboard.hint.netForecast': 'Saldo netto corrente, confronto con il mese precedente e proiezione di fine mese.',
        'dashboard.nextExpense.title': 'Prossima Spesa',
        'dashboard.nextIncome.title': 'Prossima Entrata',
        'dashboard.hint.nextExpense': 'La prossima uscita futura in ordine cronologico (ricorrente o una tantum).',
        'dashboard.hint.nextIncome': 'La prossima entrata futura in ordine cronologico.',
        'dashboard.daySuffix': 'g',
    // About Page
    'about.title': 'Informazioni su JANET',
    'about.tagline': 'Controllo chiaro sulle tue finanze personali, senza distrazioni.',
    'about.section.who': 'Per Chi',
    'about.who.body': 'Creator, freelance e persone che vogliono capire \"dove vanno i soldi\" ogni mese senza tabelle complicate.',
    'about.section.value': 'Cosa Ottieni',
    'about.value.points': 'Riepilogo immediato, ricorrenze automatiche, budget mensili, proiezione di fine mese, insight categorie, multi‑workspace (lavoro / personale).',
    'about.section.pillars': 'I 4 Pilastri',
    'about.pillars.list': 'Velocità di inserimento • Chiarezza visiva • Insight immediati • Dati tuoi (offline prima).',
    'about.section.roadmap': 'In Arrivo',
    'about.roadmap.items': 'Barra mobile riassuntiva, alert intelligenti budget, mix spesa ricorrente vs variabile, export mensile migliorato, analisi multi‑mese.',
    'about.section.trust': 'Privacy & Dati',
    'about.trust.body': 'I tuoi dati restano nel tuo workspace; puoi lavorare offline e sincronizzare solo quando vuoi. Nessuna vendita dati, nessuna pubblicità.',
    'about.section.collaboration': 'Collaborazione',
    'about.collaboration.body': 'Puoi invitare altre persone nello stesso workspace per una visione condivisa (es. famiglia, side‑project). Ogni modifica è sincronizzata e tracciata nelle azioni principali.',
    'about.section.feedback': 'Feedback',
    'about.feedback.body': 'Hai un\'idea o qualcosa che manca? Apri una issue o lascia un suggerimento: la roadmap evolve sulle necessità reali.',
    'about.section.cta': 'Inizia',
    'about.cta.body': 'Crea un workspace, aggiungi le prime 5 spese e osserva come cambia il saldo: la consapevolezza parte subito.',
    'about.section.license': 'Nota',
    'about.license.body': 'Progetto in evoluzione, uso personale sperimentale: licenza definitiva in definizione.',
    'about.back': 'Torna alla Dashboard',
        'confirm.title': 'Conferma',
        'confirm.ok': 'Conferma',
        'confirm.cancel': 'Annulla',
        'page.home.title': 'Movimenti',
        'page.home.desc': 'Vista principale dei movimenti con saldo cumulato, proiezioni e grafico.',
        'page.calendar.title': 'Calendario',
        'page.calendar.desc': 'Visuale mensile di entrate e uscite.',
        'page.config.title': 'Configurazione Movimenti',
        'page.config.desc': 'Crea e modifica spese una tantum o ricorrenti e gestisci i budget mensili. Questa sezione configura i dati che alimentano i movimenti.',
        'page.movimenti.title': 'Movimenti',
        'page.movimenti.desc': 'Elenco cronologico di entrate e uscite con saldo progressivo e trend.',
        'notify.import.success': 'Import completato',
        'notify.import.invalidFormat': 'Formato non valido',
        'notify.import.invalidJson': 'JSON invalido',
        'notify.import.readError': 'Lettura file fallita',
        'notify.invite.error': 'Errore invito',
        'notify.invite.duplicate': 'Invito già esistente (link aggiornato).',
        'notify.invite.created': 'Invito creato.',
        'notify.link.copied': 'Link copiato',
        'notify.invite.deleted': 'Invito eliminato',
        'notify.member.removed': 'Membro rimosso',
        'invite.status.pending': 'in attesa',
        'invite.status.accepted': 'accettato',
        'invite.status.declined': 'rifiutato',
        'invite.status.expired': 'scaduto',
        'toast.close': 'Chiudi',
        // Invite acceptance page
        'invite.page.title': 'Invito Workspace',
        'invite.page.received': 'Hai ricevuto un invito. Conferma per unirti al workspace.',
        'invite.page.accept': 'Accetta Invito',
        'invite.error.notFound': 'Invito non trovato',
        'invite.error.expired': 'Invito scaduto',
        'invite.error.load': 'Errore caricamento invito',
        'invite.error.accept': 'Errore accettazione invito',
        'invite.error.authRequired': 'Devi autenticarti prima di accettare',
        'invite.accepted': 'Invito accettato, workspace attivato',
        // Calendar day details
        'calendar.none': 'Nessun movimento',
        'calendar.synthetic': 'Istanza ricorrenza sintetica',
        // Generic field labels (confirm detail blocks)
        'field.category': 'Categoria',
        'field.limit': 'Limite',
        'field.spentMonth': 'Speso mese',
        // Config / Workspace page
        'config.section.workspace': 'Workspace & Sync',
        'config.workspace.label': 'Workspace',
        'config.workspace.cloudOn': '(cloud sync attivo)',
        'config.workspace.cloudOff': '(solo locale)',
        'config.workspace.id': 'ID',
        'config.export': 'Export JSON',
        'config.import': 'Import JSON',
        'config.invites.title': 'Inviti Workspace',
        'config.invites.emailPlaceholder': 'email',
        'config.invites.inviteButton': 'Invita',
        'config.invites.sentByYou': 'inviato da te',
        'config.invites.by': 'by',
        'config.invites.none': 'Nessun invito',
        'config.incoming.title': 'I tuoi Inviti in Arrivo',
        'config.incoming.invitedAs': 'Invitato come',
        'config.incoming.none': 'Nessun invito in arrivo',
        'config.audit.title': 'Audit Log (ultimi)',
        'config.audit.none': 'Nessun log',
        'config.invite.accept': 'Accetta',
        'config.invite.decline': 'Rifiuta',
        'config.confirm.removeMember.title': 'Rimuovere il membro dal workspace?',
        'config.confirm.removeMember.desc': 'Il membro perderà accesso al workspace (può essere reinvitato).',
        'config.confirm.removeMember.confirm': 'Rimuovi',
        'config.confirm.deleteInvite.title': 'Eliminare questo invito?',
        'config.confirm.deleteInvite.desc': 'Questa azione rimuove l\'invito. Potrai inviarne uno nuovo in seguito.',
        'config.confirm.deleteInvite.confirm': 'Elimina',
        'config.invite.delete.titleAttr': 'Elimina invito',
        'config.member.remove.titleAttr': 'Rimuovi membro',
    },
    en: {
        'nav.movements': 'Movements',
        'nav.config': 'Config',
        'nav.calendar': 'Calendar',
        'nav.menu': 'Menu',
        'nav.closeMenu': 'Close',
        'nav.logout': 'Logout',
        'nav.login': 'Login',
        'nav.newWorkspace': 'New workspace',
        'nav.theme.toggle': 'Toggle theme',
        'nav.theme.mode': 'Theme mode',
        'nav.theme.system': 'System',
        'nav.theme.light': 'Light',
        'nav.theme.dark': 'Dark',
        'nav.language': 'Language',
        'lang.it': 'Italian',
        'lang.en': 'English',
        'workspace.externalSuffix': '(external)',
        'workspace.newPrompt': 'New workspace name',
        'sync.local': 'Local',
        'sync.saving': 'Saving…',
        'sync.synced': 'Synced',

        // Alerts (dashboard / budgets)
        'alert.budget.nearLimit': 'Budget near limit',
        'alert.budget.over': 'Budget exceeded',
        'alert.budget.fastPace': 'Budget fast pace',
        'alert.noBudgets': 'No budgets defined',
        'alert.uncategorized': 'Uncategorized movements',

        'form.expense.new': 'New Expense',
        'form.expense.oneoff': 'One-off',
        'form.expense.recurring': 'Recurring',
        'form.description': 'Description',
        'form.amount': 'Amount',
        'form.date': 'Date',
        'form.category': 'Category',
        'form.direction.out': 'Expense',
        'form.direction.in': 'Income',
        'form.frequency.weekly': 'Weekly',
        'form.frequency.monthly': 'Monthly',
        'form.frequency.yearly': 'Yearly',
        'form.add': 'Add',
        'form.required': 'Required',
        'form.invalidNumber': 'Invalid number',
        'form.mustBeGtZero': 'Must be > 0',
        'form.dateRequired': 'Date required',

        'calendar.prevMonth': 'Previous month',
        'calendar.nextMonth': 'Next month',
        'calendar.today': 'Today',
        'calendar.month': 'Month',
        'calendar.year': 'Year',
        'calendar.incomeTotal': 'Income',
        'calendar.expenseTotal': 'Expenses',
        'calendar.density': 'Density',
        'calendar.density.normal': 'Normal',
        'calendar.density.compact': 'Compact',
        'calendar.showRecurring': 'Show recurrences',
        'calendar.heatmap': 'Heatmap',
        'calendar.heatmap.enable': 'Enable heatmap',
        'calendar.heatmap.disable': 'Disable heatmap',
        'calendar.viewMode': 'View',
        'calendar.view.list': 'List',
        'calendar.view.category': 'Categories',
        'calendar.incomes': 'Income',
        'calendar.expenses': 'Expenses',
        'calendar.weekdays.mon': 'Mon',
        'calendar.weekdays.tue': 'Tue',
        'calendar.weekdays.wed': 'Wed',
        'calendar.weekdays.thu': 'Thu',
        'calendar.weekdays.fri': 'Fri',
        'calendar.weekdays.sat': 'Sat',
        'calendar.weekdays.sun': 'Sun',
        'calendar.close': 'Close',
        'calendar.backToToday': 'Back to Today',
        'calendar.dailySummary': 'Daily summary and movements.',
        'calendar.add.hint': 'Hint: use comma or dot for decimals.',

        'generic.close': 'Close',
        'generic.on': 'On',
        'generic.off': 'Off',
        'quick.addOpen': 'Quick add',
        'quick.addTitle': 'Quick Add',
        'quick.cancel': 'Cancel',
        'quick.save': 'Save',
        'quick.saving': '...',
        'quick.fastAdd': 'Quick Add',
        'confirm.close': 'Close',
        'table.empty': 'No items',
        'budget.monthly': 'Monthly',
        'stats.income': 'Income',
        'stats.expenses': 'Expenses',
        'chart.ledger': 'Ledger Trend',
        'mov.from': 'From',
        'mov.to': 'To',
        'mov.direction': 'Direction',
        'mov.direction.all': 'Income + Expenses',
        'mov.direction.in': 'Only Income',
        'mov.direction.out': 'Only Expenses',
        'mov.category': 'Category',
        'mov.category.all': 'All',
        'mov.search': 'Search',
        'mov.search.placeholder': 'text or category',
        'mov.density': 'Density',
        'mov.density.normal': 'Normal',
        'mov.density.compact': 'Compact',
        'mov.export': 'Export',
        'mov.income': 'Income',
        'mov.expenses': 'Expenses',
        'mov.net': 'Net Balance',
        'mov.finalBalance': 'Final Balance',
        'mov.sort': 'Sort',
        'mov.col.date': 'Date',
        'mov.col.description': 'Description',
        'mov.col.category': 'Category',
        'mov.col.amount': 'Amount',
        'mov.col.balance': 'Balance',
        'mov.col.actions': 'Actions',
        'mov.actions.save': 'Save changes',
        'mov.actions.cancel': 'Cancel edit',
        'mov.actions.edit': 'Edit movement',
        'mov.actions.delete': 'Delete movement',
        'mov.none': 'No movements',
        'mov.future': 'FUTURE',
        'mov.delete.title': 'Delete movement',
        'mov.delete.confirm': 'Confirm deletion of',
        'mov.delete.irreversible': 'This action is irreversible.',
        'mov.delete.confirmLabel': 'Delete',
        'mov.field.date': 'Date',
        'mov.field.category': 'Category',
        'mov.field.amount': 'Amount',
        'mov.field.balanceAfter': 'Balance after',
        'expenses.title': 'Expenses',
        'expenses.filter.all': 'All',
        'expenses.filter.oneoff': 'One-off',
        'expenses.filter.recurring': 'Recurring',
        'expenses.badge.template': 'TEMPLATE',
        'expenses.badge.instance': 'RECURRENCE',
        'expenses.edit': 'Edit',
        'expenses.delete': 'Delete',
        'expenses.none': 'No expenses',
        'expenses.delete.title': 'Delete expense',
        'expenses.delete.confirm': 'Confirm deletion of selected expense?',
        'generic.cancel': 'Cancel',
        'generic.save': 'Save',
        'budget.new': 'New Budget',
        'budget.limitMonthly': 'Monthly Limit',
        'budget.add': 'Add Budget',
        'budget.none': 'No budget defined.',
        'budget.titleCurrentMonth': 'Budgets (Current Month)',
        'budget.edit': 'Edit',
        'budget.delete': 'Delete',
        'budget.remaining': 'remaining',
        'budget.over': 'over',
        'budget.limit': 'Limit',
        'budget.spentMonth': 'Spent month',
        'budget.delete.title': 'Delete budget',
        'budget.delete.confirm': 'Confirm deletion of selected budget? This month progress will be lost.',
        'stats.incomeTotal': 'Income',
        'stats.expenseTotal': 'Expenses',
        'stats.balance': 'Balance',
        'stats.balance.hint': 'Income - Expenses',
        'stats.categories': 'Categories',
        'stats.categories.hint': 'Distinct totals',
        'stats.recurring': 'Recurring',
        'stats.recurring.hint': 'Active templates',
        'stats.monthSpend': 'Month Spend',
        'stats.monthSpend.hint': 'Sum categories',
        'chart.projections': 'Projections',
        'chart.smooth': 'Smooth',
        'chart.points': 'Points',
        'chart.last': 'Last',
        'chart.lastReal': 'Last real',
        'chart.lastProjected': 'Last projected',
        'chart.projectionBadge': 'projection',
        'chart.min': 'Min',
        'chart.max': 'Max',
        // Dashboard new components
        'dashboard.budget.title': 'Budget Usage',
        'dashboard.budget.fastPace': 'Fast pace',
        'dashboard.budget.near': 'Near limit',
        'dashboard.budget.over': 'Over',
        'dashboard.category.uncategorized': 'Uncategorized',
        'dashboard.topCategories.title': 'Top Categories',
        'dashboard.maxExpense': 'Largest Expense',
        'dashboard.maxIncome': 'Largest Income',
        // Dashboard hint tooltips
        'dashboard.hint.budgetUsage': 'Progress of budgets vs monthly limit and spending pace.',
        'dashboard.hint.topCategories': 'Top spending categories for the current month (top 5).',
        'dashboard.hint.extremes': 'Largest single income and expense recorded this month.',
        'dashboard.hint.netForecast': 'Current net balance, month-over-month comparison and end-of-month projection.',
        'dashboard.nextExpense.title': 'Next Expense',
        'dashboard.nextIncome.title': 'Next Income',
        'dashboard.hint.nextExpense': 'The next future outgoing movement chronologically (recurring or one-off).',
        'dashboard.hint.nextIncome': 'The next future incoming movement chronologically.',
        'dashboard.daySuffix': 'd',
    // About Page
    'about.title': 'About JANET',
    'about.tagline': 'Clear control over your personal finances without noise.',
    'about.section.who': 'Who It’s For',
    'about.who.body': 'Creators, freelancers and anyone who wants to see "where the money goes" monthly—without complex spreadsheets.',
    'about.section.value': 'What You Get',
    'about.value.points': 'Instant overview, automatic recurrences, monthly budgets, end‑of‑month projection, category insights, multi‑workspace (work / personal).',
    'about.section.pillars': 'The 4 Pillars',
    'about.pillars.list': 'Fast input • Visual clarity • Immediate insight • Your data (offline first).',
    'about.section.roadmap': 'Coming Soon',
    'about.roadmap.items': 'Mobile summary bar, smart budget alerts, recurring vs variable mix, improved monthly export, multi‑month analysis.',
    'about.section.trust': 'Privacy & Data',
    'about.trust.body': 'Your data stays in your workspace; you can work offline and sync only when you wish. No data selling, no ads.',
    'about.section.collaboration': 'Collaboration',
    'about.collaboration.body': 'Invite others into the same workspace for shared visibility (family, side‑project). Each change syncs and key actions are tracked.',
    'about.section.feedback': 'Feedback',
    'about.feedback.body': 'Have an idea or missing piece? Open an issue or share a suggestion: roadmap adapts to real needs.',
    'about.section.cta': 'Get Started',
    'about.cta.body': 'Create a workspace, add your first 5 expenses and watch the balance change: awareness begins immediately.',
    'about.section.license': 'Note',
    'about.license.body': 'Evolving project, experimental personal use: final licensing TBD.',
    'about.back': 'Back to Dashboard',
        'confirm.title': 'Confirm',
        'confirm.ok': 'Confirm',
        'confirm.cancel': 'Cancel',
        'page.home.title': 'Movements',
        'page.home.desc': 'Main movements view with cumulative balance, projections and chart.',
        'page.calendar.title': 'Calendar',
        'page.calendar.desc': 'Monthly view of incomes and expenses.',
        'page.config.title': 'Movements Configuration',
        'page.config.desc': 'Create and edit one-off or recurring expenses and manage monthly budgets. This section configures the data powering movements.',
        'page.movimenti.title': 'Movements',
        'page.movimenti.desc': 'Chronological list of incomes and expenses with running balance and trend.',
        'notify.import.success': 'Import completed',
        'notify.import.invalidFormat': 'Invalid format',
        'notify.import.invalidJson': 'Invalid JSON',
        'notify.import.readError': 'File read failed',
        'notify.invite.error': 'Invite error',
        'notify.invite.duplicate': 'Invite already exists (link updated).',
        'notify.invite.created': 'Invite created.',
        'notify.link.copied': 'Link copied',
        'notify.invite.deleted': 'Invite deleted',
        'notify.member.removed': 'Member removed',
        'invite.status.pending': 'pending',
        'invite.status.accepted': 'accepted',
        'invite.status.declined': 'declined',
        'invite.status.expired': 'expired',
        'toast.close': 'Close',
        // Invite acceptance page
        'invite.page.title': 'Workspace Invite',
        'invite.page.received': 'You received an invite. Confirm to join the workspace.',
        'invite.page.accept': 'Accept Invite',
        'invite.error.notFound': 'Invite not found',
        'invite.error.expired': 'Invite expired',
        'invite.error.load': 'Invite load error',
        'invite.error.accept': 'Invite acceptance error',
        'invite.error.authRequired': 'You must authenticate before accepting',
        'invite.accepted': 'Invite accepted, workspace activated',
        // Calendar day details
        'calendar.none': 'No movements',
        'calendar.synthetic': 'Synthetic recurrence instance',
        // Generic field labels (confirm detail blocks)
        'field.category': 'Category',
        'field.limit': 'Limit',
        'field.spentMonth': 'Spent month',
        // Config / Workspace page
        'config.section.workspace': 'Workspace & Sync',
        'config.workspace.label': 'Workspace',
        'config.workspace.cloudOn': '(cloud sync on)',
        'config.workspace.cloudOff': '(local only)',
        'config.workspace.id': 'ID',
        'config.export': 'Export JSON',
        'config.import': 'Import JSON',
        'config.invites.title': 'Workspace Invites',
        'config.invites.emailPlaceholder': 'email',
        'config.invites.inviteButton': 'Invite',
        'config.invites.sentByYou': 'sent by you',
        'config.invites.by': 'by',
        'config.invites.none': 'No invites',
        'config.incoming.title': 'Your Incoming Invites',
        'config.incoming.invitedAs': 'Invited as',
        'config.incoming.none': 'No incoming invites',
        'config.audit.title': 'Audit Log (recent)',
        'config.audit.none': 'No log entries',
        'config.invite.accept': 'Accept',
        'config.invite.decline': 'Decline',
        'config.confirm.removeMember.title': 'Remove the member from the workspace?',
        'config.confirm.removeMember.desc': 'The member will lose access (can be reinvited).',
        'config.confirm.removeMember.confirm': 'Remove',
        'config.confirm.deleteInvite.title': 'Delete this invite?',
        'config.confirm.deleteInvite.desc': 'This action removes the invite. You can send a new one later.',
        'config.confirm.deleteInvite.confirm': 'Delete',
        'config.invite.delete.titleAttr': 'Delete invite',
        'config.member.remove.titleAttr': 'Remove member',
    }
};

interface I18nContextValue {
    locale: Locale;
    setLocale: (l: Locale) => void;
    t: (key: string) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

const LS_KEY = 'janet.locale';

export const I18nProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
    const [locale, _setLocale] = React.useState<Locale>(() => {
        if (typeof window !== 'undefined') {
            const stored = window.localStorage.getItem(LS_KEY) as Locale | null;
            if (stored === 'en' || stored === 'it') return stored;
            const nav = navigator.language.startsWith('it') ? 'it' : 'en';
            return nav;
        }
        return 'en';
    });

    const setLocale = useCallback((l: Locale) => {
        _setLocale(l);
        if (typeof window !== 'undefined') {
            window.localStorage.setItem(LS_KEY, l);
            document.documentElement.lang = l;
        }
    }, []);

    const t = useCallback((key: string) => {
        const dict = translations[locale] || translations.en;
        return dict[key] || translations.en[key] || key;
    }, [locale]);

    const value = useMemo(() => ({ locale, setLocale, t }), [locale, setLocale, t]);
    return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export function useI18n() {
    const ctx = useContext(I18nContext);
    if (!ctx) throw new Error('useI18n must be used within I18nProvider');
    return ctx;
}

// Helper to access raw translations (for potential future export or adding new locales)
export const _translations = translations;
